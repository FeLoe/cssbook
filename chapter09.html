<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Computational Analysis of Communication - 9&nbsp; Processing text</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./chapter10.html" rel="next">
<link href="./chapter08.html" rel="prev">
<link href="./img/favicon.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


</head>

<body class="nav-sidebar floating">


<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Processing text</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Computational Analysis of Communication</a> 
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Table of Contents</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter01.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter02.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Getting started: Fun with data and visualizations</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter03.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Programming concepts for data analysis</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter04.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">How to write code</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter05.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">From file to data frame and back</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter06.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Data Wrangling</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter07.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Exploratory data analysis</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter08.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Statistical Modeling and Supervised Machine Learning</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter09.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Processing text</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter10.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Text as data</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter11.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Automatic analysis of text</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter12.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Scraping online data</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter13.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Network Data</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter14.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Multimedia data</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter15.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Scaling up and distributing</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter16.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Where to go next</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">References</a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#sec-unicode" id="toc-sec-unicode" class="nav-link active" data-scroll-target="#sec-unicode"><span class="toc-section-number">9.1</span>  Text as a String of Characters</a>
  <ul class="collapse">
  <li><a href="#sec-textmethods" id="toc-sec-textmethods" class="nav-link" data-scroll-target="#sec-textmethods"><span class="toc-section-number">9.1.1</span>  Methods for Dealing With Text</a></li>
  </ul></li>
  <li><a href="#sec-regular" id="toc-sec-regular" class="nav-link" data-scroll-target="#sec-regular"><span class="toc-section-number">9.2</span>  Regular Expressions</a>
  <ul class="collapse">
  <li><a href="#sec-regex" id="toc-sec-regex" class="nav-link" data-scroll-target="#sec-regex"><span class="toc-section-number">9.2.1</span>  Regular Expression Syntax</a></li>
  <li><a href="#sec-regexamples" id="toc-sec-regexamples" class="nav-link" data-scroll-target="#sec-regexamples"><span class="toc-section-number">9.2.2</span>  Example Patterns</a></li>
  </ul></li>
  <li><a href="#sec-regextract" id="toc-sec-regextract" class="nav-link" data-scroll-target="#sec-regextract"><span class="toc-section-number">9.3</span>  Using Regular Expressions in Python and R</a>
  <ul class="collapse">
  <li><a href="#sec-regexadvanced" id="toc-sec-regexadvanced" class="nav-link" data-scroll-target="#sec-regexadvanced"><span class="toc-section-number">9.3.1</span>  Splitting and Joining Strings, and Extracting Multiple Matches</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="sec-chap-protext" class="quarto-section-identifier d-none d-lg-block"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Processing text</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<div class="cell">

</div>
<p><strong>Abstract.</strong> Many datasets that are relevant for social science consist of textual data, from political discussions and newspaper archives to open-ended survey questions and reviews. This chapter gives an introduction to dealing with textual data using base functions in Python and (mostly) the <em>stringr</em> package in R.</p>
<p><strong>Keywords.</strong> text representation, text cleaning, regular expressions</p>
<p><strong>Objectives:</strong></p>
<ul>
<li>Understand how text is represented in the computer</li>
<li>Be able to clean up and alter text</li>
<li>Understand and be able to use regular expressions</li>
</ul>
<div class="callout-note callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Packages used in this chapter
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>This chapter introduces the packages for handling textual data. For R, this is mainly the <em>stringr</em> package (included in <em>tidyverse</em>). In Python, most functions are built-in, but will show how to use these functions in <em>pandas</em> and also introduce the <em>regex</em> package, an alternative to built-in regular expressions. You can install these packages with the code below if needed (see Section <a href="chapter01.html#sec-installing"><span>1.4</span></a> for more details):</p>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true">Python code</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">R code</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip3 install regex pandas</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="fu">c</span>(<span class="st">"glue"</span>, <span class="st">"tidyverse"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<p>After installing, you need to import (activate) the packages every session:</p>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true">Python code</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false">R code</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> regex</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glue)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<p>When dealing with textual data, an important step is to normalize the data. Such preprocessing ensures that noise is removed, and reduces the amount of data to deal with. In Section <a href="chapter05.html#sec-encodings"><span>5.2.2</span></a> we explained how to read data from different formats, such as txt, csv or json that can include textual data, and we also mentioned some of the challenges when reading text (e.g., encoding/decoding from/to Unicode). In this section we cover typical cleaning steps such as lowercasing and removing punctuation, HTML tags and boilerplate.</p>
<p>As a computational communication scientist you will come across many sources of text that range from electronic versions of newspapers in HTML to parliamentary speeches in PDF. Moreover, most of the contents in their original shape will include data that will not be of interest for the analysis but, instead, will produce noise that might negatively affect the quality of the research. You have to decide which parts of the raw text should be considered for analysis and determine the shape of these contents in order to have a good input in the analytical process.</p>
<p>As the difference between useful information and noise is determined by your research question, there is not a fixed list of steps to take that can guide you in this preprocessing stage. It is highly likely that you will have to test different combinations of steps and assess what the best options are. For example, in some cases keeping capital letters within a chat conversation or a news comment might be valuable to detect the tone of the message, but in more formal speeches transforming the whole text to lowercases would help to normalize the content. However, it is true that there are some typical challenges to reducing the noise from the text.</p>
<p>This chapter and the next will show you how to clean and manipulate text to transform the raw strings of letters into useful data. This chapter focuses on dealing with the text as characters and especially shows you how to use <em>regular expressions</em> to search and replace textual content. The next chapter will focus on text as words and shows how you can represent text in a suitable format for further computational analysis.</p>
<section id="sec-unicode" class="level2" data-number="9.1">
<h2 data-number="9.1" class="anchored" data-anchor-id="sec-unicode"><span class="header-section-number">9.1</span> Text as a String of Characters</h2>
<div class="callout-note callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Important: Unicode and Encodings
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Technically speaking, text is represented as bytes (numbers) rather than characters. The Unicode standard determines how these bytes should be interpreted or “decoded”. This chapter assumes that the bytes in a file are already “decoded” into characters (or Unicode code points), and we can just work with the characters. Especially if you are not working with English text, it is very important to make sure you understand Unicode and encodings and check that the texts you work with are decoded properly. Please see Section <a href="chapter05.html#sec-encodings"><span>5.2.2</span></a> for more information on how this works.</p>
</div>
</div>
</div>
<p>When we think about text, we might think of sentences or words, but the computer only “thinks” about letters: text is represented internally as a string of characters. This is reflected of course in the type name, with R calling it a <em>character</em> vector and Python a <em>string</em>.</p>
<div class="callout-note callout callout-style-simple no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<div id="exm-text" class="theorem example">
<p><span class="theorem-title"><strong>Example 9.1 </strong></span>Internal representation and of single and multiple texts.</p>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true">Python code</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false">R code</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>text <span class="op">=</span> <span class="st">"This is text."</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"type(text): </span><span class="sc">{</span><span class="bu">type</span>(text)<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>type(text): &lt;class 'str'&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"len(text): </span><span class="sc">{</span><span class="bu">len</span>(text)<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>len(text): 13</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"text[0]: '</span><span class="sc">{</span>text[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">'"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>text[0]: 'T'</code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"text[5:7]: '</span><span class="sc">{</span>text[<span class="dv">5</span>:<span class="dv">7</span>]<span class="sc">}</span><span class="ss">'"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>text[5:7]: 'is'</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"text[-1]: '</span><span class="sc">{</span>text[<span class="op">-</span><span class="dv">1</span>]<span class="sc">}</span><span class="ss">'"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>text[-1]: '.'</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"text[-4:]: '</span><span class="sc">{</span>text[<span class="op">-</span><span class="dv">5</span>:]<span class="sc">}</span><span class="ss">'"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>text[-4:]: 'text.'</code></pre>
</div>
</div>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>text <span class="ot">=</span> <span class="st">"This is text."</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">glue</span>(<span class="st">"class(text): {class(text)}"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>class(text): character</code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glue</span>(<span class="st">"length(text): {length(text)}"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>length(text): 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glue</span>(<span class="st">"text[1]: {text[1]}"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>text[1]: This is text.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glue</span>(<span class="st">"str_length(text): {str_length(text)}"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>str_length(text): 13</code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glue</span>(<span class="st">"str_sub(text, 6,7): {str_sub(text, 6,7)}"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>str_sub(text, 6,7): is</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" role="tab" aria-controls="tabset-4-1" aria-selected="true">Python code</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-2" role="tab" aria-controls="tabset-4-2" aria-selected="false">R code</a></li></ul>
<div class="tab-content">
<div id="tabset-4-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-4-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>words <span class="op">=</span> [<span class="st">"These"</span>, <span class="st">"are"</span>, <span class="st">"words"</span>]</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"type(words): </span><span class="sc">{</span><span class="bu">type</span>(words)<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>type(words): &lt;class 'list'&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"len(words): </span><span class="sc">{</span><span class="bu">len</span>(words)<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>len(words): 3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"words[0]: '</span><span class="sc">{</span>words[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">'"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>words[0]: 'These'</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"words[1:3]: '</span><span class="sc">{</span>words[<span class="dv">1</span>:<span class="dv">3</span>]<span class="sc">}</span><span class="ss">'"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>words[1:3]: '['are', 'words']'</code></pre>
</div>
</div>
</div>
<div id="tabset-4-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>words <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"These"</span>, <span class="st">"are"</span>, <span class="st">"words"</span>)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="fu">glue</span>(<span class="st">"class(words): {class(words)}"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>class(words): character</code></pre>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"length(words): {length(words)}"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "length(words): {length(words)}"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glue</span>(<span class="st">"words[1]: {words[1]}"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>words[1]: These</code></pre>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Note: use collapse to convert to single value</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>words_2_3 <span class="ot">=</span> <span class="fu">str_c</span>(words[<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>], <span class="at">collapse=</span><span class="st">", "</span>)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="fu">glue</span>(<span class="st">"words[2:3]: {words_2_3}"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>words[2:3]: are, words</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<p>As a simple example, the figure at the top of Example <a href="#exm-text"><span>9.1</span></a> shows how the text “This is text.” is represented. This text is split into separate characters, with each character representing a letter (or space, punctuation, emoji, or Chinese character). These characters are indexed starting from the first one, with (as always) R counting from one, but Python counting from zero.</p>
<p>In Python, texts are represented as <code>str</code> (string) objects, in which we can directly address the individual characters by their position: <code>text[0]</code> is the first character of <code>text</code>, and so on. In R, however, texts (like all objects) represent columns (or vectors) rather than individual values. Thus, <code>text[1]</code> in R is the first text in a series of text. To access individual characters in a text, you have to use a function such as <code>str_length</code> and <code>str_sub</code> that will be discussed in more detail below. This also means that in Python, if you have a column (or list) of strings that you need to apply an operation to, you either need to use one of /textitPandas’ methods shown below or use a <em>for loop</em> or <em>list comprehension</em> to iterate over all the strings (see also section 3.2).</p>
<section id="sec-textmethods" class="level3" data-number="9.1.1">
<h3 data-number="9.1.1" class="anchored" data-anchor-id="sec-textmethods"><span class="header-section-number">9.1.1</span> Methods for Dealing With Text</h3>
<div class="callout-note callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Stringi, stringr, and base string operations in R
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>As is so often the case, R has multiple packages that partially replicate functionality for basic text handling. In this book we will mainly use the <em>stringr</em> package, which is part of <em>tidyverse</em>. This is not because that package is necessarily better or easier than the alternative <em>stringi</em> package or the built-in (<em>base</em>) methods. However, the methods are well-documented, clearly named, and consistent with other tidyverse functions, so for now it is easiest to stick to <em>stringr</em>. In particular, <em>stringr</em> is very similar to <em>stringi</em> (and in fact is partially based on it). So, to give one example, the function <code>str_detect</code> is more or less the same as <code>stringi::str_detect</code> and <code>base::grepl</code>.</p>
</div>
</div>
</div>
<p>The first thing to keep in mind is that once you load any text in R or Python, you usually store this content as a <em>character</em> or <em>string</em> object (you may also often use <em>lists</em> or <em>dictionaries</em>, but they will have strings inside them), which means that basic operations and conditions of this data type apply, such as indexing or slicing to access individual characters or substrings (see Section <a href="chapter03.html#sec-datatypes"><span>3.1</span></a>). In fact, base strings operations are very powerful to clean your text and eliminate a large amount of noise. Table <a href="#tbl-stringoperations"><span>9.1</span></a> summarizes some useful operations on strings in R and Python that will help you in this stage.</p>
<div class="cell">

</div>
<div id="tbl-stringoperations" class="anchored">
<table class="table">
<caption>Table&nbsp;9.1: Useful strings operations in R and Python to clean noise.</caption>
<colgroup>
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
</colgroup>
<thead>
<tr class="header">
<th>String operation</th>
<th>R (<em>stringr</em>)</th>
<th>Python</th>
<th>Pandas</th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td></td>
<td>(whole column)</td>
<td>(single string)</td>
<td>(whole column)</td>
<td></td>
</tr>
<tr class="even">
<td>Count characters in s</td>
<td><code>str_length(s)</code></td>
<td><code>len(s)</code></td>
<td><code>s.str.len()</code></td>
<td></td>
</tr>
<tr class="odd">
<td>Extract a substring</td>
<td><code>str_sub(s, n1, n2)</code></td>
<td><code>s[n1:n2]</code></td>
<td><code>s.str.slice(n1, n2)</code></td>
<td></td>
</tr>
<tr class="even">
<td>Test if s contains s2</td>
<td><code>str_detect(s, s2)</code><a href="#fnre" class="footnote-ref" role="doc-noteref" aria-expanded="false"><sup>*</sup></a></td>
<td><code>s2 in s</code></td>
<td><code>s.str.match(s2)</code><a href="#fnre" class="footnote-ref" role="doc-noteref" aria-expanded="false"><sup>*</sup></a></td>
<td></td>
</tr>
<tr class="odd">
<td>Strip spaces</td>
<td><code>trimws(s)</code></td>
<td><code>s.strip()</code></td>
<td><code>s.str.strip()</code></td>
<td></td>
</tr>
<tr class="even">
<td>Convert to lowercase</td>
<td><code>tolower(s)</code></td>
<td><code>s.lower()</code></td>
<td><code>s.str.lower()</code></td>
<td></td>
</tr>
<tr class="odd">
<td>Convert to uppercase</td>
<td><code>toupper(s)</code></td>
<td><code>s.upper()</code></td>
<td><code>s.str.upper()</code></td>
<td></td>
</tr>
<tr class="even">
<td>Find s1 and replace by s2</td>
<td><code>str_replace(s, s1, s2)</code><a href="#fnre" class="footnote-ref" role="doc-noteref" aria-expanded="false"><sup>*</sup></a></td>
<td><code>s.replace(s1, s2)</code></td>
<td><code>s.str.replace(s1, s2)</code><a href="#fnre" class="footnote-ref" role="doc-noteref" aria-expanded="false"><sup>*</sup></a></td>
<td></td>
</tr>
</tbody>
</table>
</div>
<section id="table-notes" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="table-notes">Table notes</h4>
<p>*) <span id="fninv">The R functions <code>str_detect</code> and <code>str_replace</code> and the Pandas function <code>s.str.match</code> and <code>s.str.replace</code> use <em>regular expressions</em> to define what to find and replace. See Section <a href="#sec-regular"><span>9.2</span></a> below for more information.</span></p>
<hr>
<p>Let us apply some of these functions/methods to a simple Wikipedia text that contains HTML tags, or boilerplate, and upper/lower case letters. Using the <em>stringr</em> function <code>str_replace_all</code> in R and <code>replace</code> in Python we can do a find-and-replace and replace substrings by others (in our case, replace <code>&lt;b&gt;</code> with a space, for instance). To remove unnecessary double spaces we apply the <code>str_squish</code> function provided by <em>stringr</em> and in Python, we first chunk our string into a list of words by using the <code>split</code> string method, before we use the <code>join</code> method to join them again with now a single space. In the case of converting letters from upper to lower case, we use the base R function <code>tolower</code> and the string method <code>lower</code> in Python. Finally, the base R function <code>trimws</code> and the Python string method <code>strip</code> remove the white space from the beginning and end of the string. Example <a href="#exm-clean"><span>9.2</span></a> shows how to conduct this cleaning process.</p>
<p>While you can get quite far with these techniques, there are more advanced and flexible approaches possible. For instance, you probably do not want to list <em>all possible</em> HTML tags in separate <code>replace</code> methods or <code>str_replace_all</code> functions. In the next section, we therefore show how to use so-called <em>regular expressions</em> to formulate such generalizable patterns.</p>
<div class="callout-note callout callout-style-simple no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<div id="exm-clean" class="theorem example">
<p><span class="theorem-title"><strong>Example 9.2 </strong></span>Some basic text cleaning approaches</p>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-5-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-1" role="tab" aria-controls="tabset-5-1" aria-selected="true">Python code</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-2" role="tab" aria-controls="tabset-5-2" aria-selected="false">R code</a></li></ul>
<div class="tab-content">
<div id="tabset-5-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-5-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>text <span class="op">=</span> <span class="st">"""   &lt;b&gt;Communication&lt;/b&gt;    </span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="st">    (from Latin communicare, meaning to share) """</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="co"># remove tags:</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>cleaned <span class="op">=</span> text.replace(<span class="st">"&lt;b&gt;"</span>, <span class="st">""</span>).replace(<span class="st">"&lt;/b&gt;"</span>, <span class="st">""</span>)</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="co"># normalize white space</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>cleaned <span class="op">=</span> <span class="st">" "</span>.join(cleaned.split())</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a><span class="co"># lower case</span></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>cleaned <span class="op">=</span> cleaned.lower()</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a><span class="co"># trim spaces from start and end</span></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>cleaned <span class="op">=</span> cleaned.strip()</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(cleaned)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>communication (from latin communicare, meaning to share)</code></pre>
</div>
</div>
</div>
<div id="tabset-5-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>text <span class="ot">=</span> <span class="st">"    &lt;b&gt;Communication&lt;/b&gt;    </span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="st">     (from Latin communicare, meaning to share)  "</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>cleaned <span class="ot">=</span> text <span class="sc">%&gt;%</span> </span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># remove HTML tags:</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_replace_all</span>(<span class="st">"&lt;b&gt;"</span>, <span class="st">" "</span>)  <span class="sc">%&gt;%</span> </span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_replace_all</span>(<span class="st">"&lt;/b&gt;"</span>, <span class="st">" "</span>)  <span class="sc">%&gt;%</span> </span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># normalize white space </span></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_squish</span>() <span class="sc">%&gt;%</span></span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># lower case</span></span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tolower</span>()  <span class="sc">%&gt;%</span> </span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># trim spaces at start and end</span></span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">trimws</span>()</span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a><span class="fu">glue</span>(cleaned)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>communication (from latin communicare, meaning to share)</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="callout-note callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
To regex or not to regex in Python
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>You may wonder why we introduce basic string methods like <code>replace</code> or the <code>split</code>-then-<code>join</code> trick, if everything can be done with regular expressions anyway. There are a couple of reasons for still using these methods: first, they are easy and don’t have any dependencies. If you just want to replace a single thing, then you don’t need to import any additional module. Second, regular expressions are considerably slower than string methods – in most cases, you won’t notice, but if you do a lot of replacements (think in thousands per news article, for a million articles), then this may matter. Third, you can use the <code>join</code> trick also for other things like punctuation removal – in this case, by generating a list of all characters in a string called <code>text</code> provided they are no punctuation characters, and then joining them directly to each other: <code>from string import punctuation; "".join([c for c in text if c not in punctuation])</code></p>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="sec-regular" class="level2" data-number="9.2">
<h2 data-number="9.2" class="anchored" data-anchor-id="sec-regular"><span class="header-section-number">9.2</span> Regular Expressions</h2>
<p>A <em>regular expression</em> or <em>regex</em> is a powerful language to locate strings that conform to a given pattern. For instance, we can extract usernames or email-addresses from text, or normalize spelling variations and improve the cleaning methods covered in the previous section. Specifically, regular expressions are a sequence of characters that we can use to design a pattern and then use this pattern to <em>find</em> strings (identify or extract) and also <em>replace</em> those strings by new ones.</p>
<p>Regular expressions look complicated, and in fact they take time to get used to initially. For example, a relatively simple (and not totally correct) expression to match an email address is <code>[\w\.-]+@[\w\.-]+\.\w\w+</code>, which doesn’t look like anything at all unless you know what you are looking for. The good news is that regular expression syntax is the same in R and Python (and many other languages), so once you learn regular expressions you will have acquired a powerful and versatile tool for text processing.</p>
<p>In the next section, we will first review general expression syntax without reference to running them in Python or R. Subsequently, you will see how you can apply these expressions to inspect and clean texts in both languages.</p>
<section id="sec-regex" class="level3" data-number="9.2.1">
<h3 data-number="9.2.1" class="anchored" data-anchor-id="sec-regex"><span class="header-section-number">9.2.1</span> Regular Expression Syntax</h3>
<p>At its core, regular expressions are patters for matching sequences of characters. In the simplest case, a regular letter just matches that letter, so the pattern “cat” matches the text “cat”. Next, there are various wildcards, or ways to match different letters. For example, the period (<code>.</code>) matches any character, so <code>c.t</code> matches both “cat” and “cot”. You can place multiple letters between square brackets to create a <em>character class</em> that matches all the specified letters, so <code>c[au]t</code> matches “cat” and “cut”, but not “cot”. There are also a number of pre-defined classes, such as <code>\w</code> which matches “word characters” (letters, digits, and (curiously) underscores).</p>
<p>Finally, for each character or group of characters you can specify how often it should occur. For example, <code>a+</code> means one or more a’s while <code>a?</code> means zero or one a, so <code>lo+l</code> matches <code>lol',</code>lool’, etc., and <code>lo?l</code> matches <code>lol' or</code>ll’. This raises the question, of course, of how to look for actual occurrences of a plus, question mark, or period. The solution is to <em>escape</em> these special symbols by placing a backslash (<code>\</code>) before them: <code>a\+</code> matches the literal text “a+”, and <code>\\w</code> (with a double backslash) matches the literal text “”.</p>
<p>Now, we can have another look at the example email address pattern given above. The first part, <code>[\w\.-]</code> creates a character class containing word characters, (literal) periods, and dashes. Thus, <code>[\w\.-]+@[\w\.-]+</code> means one or more letters, digits, underscores, periods, or dashes, followed by an at sign, followed by one or more letters, digits, etc. Finally, the last part <code>\.\w\w+</code> means a literal period, a word character, and one or more word characters. In other words, we are looking for a name (possibly containing dashes or periods) before the at sign, followed by a domain, followed by a top level domain (like <code>.com</code>) of at least two characters.</p>
<p>In essence, thinking in terms of what you want to match and how often you want to match it is all there is to regular expressions. However, it will take some practice to get comfortable with turning something sensible (such as an email address) into a correct regular expression pattern. The next subsection will explain regular expression syntax in more detail, followed by an explanation of grouping, and in the final subsection we will see how to use these regular expressions in R and Python to do text cleaning.</p>
<div class="cell">

</div>
<div id="tbl-regex" class="anchored">
<table class="table">
<caption>Table&nbsp;9.2: Regular expression syntax</caption>
<colgroup>
<col style="width: 55%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
</colgroup>
<thead>
<tr class="header">
<th>Function</th>
<th>Syntax</th>
<th>Example</th>
<th>Matches</th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Specifier: What to match</strong></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>All characters except for new lines</td>
<td><code>.</code></td>
<td><code>d.g</code></td>
<td><code>d<strong>i</strong>g</code>,<code>d<strong>!</strong>g</code></td>
<td></td>
</tr>
<tr class="odd">
<td>Word characters<a href="#fninv" class="footnote-ref" role="doc-noteref" aria-expanded="false"><sup>*</sup></a>(letters, digits,_)</td>
<td><code>\w</code></td>
<td><code>d\wg</code></td>
<td><code>dig</code>,<code>dog</code></td>
<td></td>
</tr>
<tr class="even">
<td>Digits<a href="#fninv" class="footnote-ref" role="doc-noteref" aria-expanded="false"><sup>*</sup></a>(0 to 9)</td>
<td><code>\d</code></td>
<td><code>202\d</code></td>
<td><code>2020</code>,<code>2021</code></td>
<td></td>
</tr>
<tr class="odd">
<td>Whitespace<a href="#fninv" class="footnote-ref" role="doc-noteref" aria-expanded="false"><sup>*</sup></a>(space, tab, newline)</td>
<td><code>\s</code></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>Newline</td>
<td><code>\n</code></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>Beginning of the string</td>
<td><code>\^</code></td>
<td><code>\^go</code></td>
<td><code><strong>go</strong><span class="gray"></span>go go</code></td>
<td></td>
</tr>
<tr class="even">
<td>Ending of the string</td>
<td><code>\$</code></td>
<td><code>go\$</code></td>
<td><code><span class="gray"></span>go go<strong>go</strong></code></td>
<td></td>
</tr>
<tr class="odd">
<td>Beginning or end of word</td>
<td><code>\b</code></td>
<td><code>\bword\b</code></td>
<td><code><span class="gray">a</span> <strong>word</strong><span class="gray"></span>!</code></td>
<td></td>
</tr>
<tr class="even">
<td>Either first or second option</td>
<td><code>…|…</code></td>
<td><code>cat|dog</code></td>
<td><code>cat</code>,<code>dog</code></td>
<td></td>
</tr>
<tr class="odd">
<td><span style="white-space:nowrap"><strong>Quantifier: How many to match</strong></span></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>Zero or more</td>
<td><code>*</code></td>
<td><code>d.*g</code></td>
<td><code>dg</code>,<code>drag</code>,<code>d = g</code></td>
<td></td>
</tr>
<tr class="odd">
<td>Zero or more (non-greedy)</td>
<td><code>*?</code></td>
<td><code>d.*?g</code></td>
<td><code><strong>dog</strong><span class="gray"></span>g</code></td>
<td></td>
</tr>
<tr class="even">
<td>One or more</td>
<td><code>+</code></td>
<td><code>\d+%</code></td>
<td><code>1%</code>,<code>200%</code></td>
<td></td>
</tr>
<tr class="odd">
<td>One or more (non-greedy)</td>
<td><code>+?</code></td>
<td><code>\d+%</code></td>
<td><code><span class="gray"></span>20<strong>0%</strong></code></td>
<td></td>
</tr>
<tr class="even">
<td>Zero or one</td>
<td><code>?</code></td>
<td><code>colou?r</code></td>
<td><code>color</code>,<code>colour</code></td>
<td></td>
</tr>
<tr class="odd">
<td>Exactly <em>n</em> times</td>
<td><code>{n}</code></td>
<td><code>\d{4}</code></td>
<td><code>1940</code>,<code>2020</code></td>
<td></td>
</tr>
<tr class="even">
<td>At least <em>n</em> times</td>
<td><code>{n,}</code></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>Between <em>n</em> and <em>m</em> times</td>
<td><code>{n,m}</code></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td><strong>Other constructs</strong></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>Groups</td>
<td><code>(…)</code></td>
<td><code>'(bla )+'</code></td>
<td><code>'bla bla bla'</code></td>
<td></td>
</tr>
<tr class="even">
<td>Selection of characters</td>
<td><code>[…]</code></td>
<td><code>d[iuo]g</code></td>
<td><code>dig</code>,<code>dug</code>,<code>dog</code></td>
<td></td>
</tr>
<tr class="odd">
<td>Range of characters in selection</td>
<td><code>[a-z]</code></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>Everything except selection</td>
<td><code>[\^...]</code></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>Escape special character</td>
<td><code>\</code></td>
<td><code>3\.14</code></td>
<td><code>3.14</code></td>
<td></td>
</tr>
<tr class="even">
<td><strong>Unicode character properties</strong><a href="#fninv" class="footnote-ref" role="doc-noteref" aria-expanded="false"><sup>†</sup></a></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>Letters<a href="#fninv" class="footnote-ref" role="doc-noteref" aria-expanded="false"><sup>*</sup></a></td>
<td><code>\p{LETTER}</code></td>
<td></td>
<td><code>words</code>,<code>単語</code></td>
<td></td>
</tr>
<tr class="even">
<td>Punctuation<a href="#fninv" class="footnote-ref" role="doc-noteref" aria-expanded="false"><sup>*</sup></a></td>
<td><code>\p{PUNCTUATION}</code></td>
<td></td>
<td><code>.</code> <code>,</code> <code>:</code></td>
<td></td>
</tr>
<tr class="odd">
<td>Quotation marks<a href="#fninv" class="footnote-ref" role="doc-noteref" aria-expanded="false"><sup>*</sup></a></td>
<td><code>\p{QUOTATION MARK}</code></td>
<td></td>
<td><code>'</code> <code>`</code> <code>"</code> <code>«</code></td>
<td></td>
</tr>
<tr class="even">
<td>Emoji<a href="#fninv" class="footnote-ref" role="doc-noteref" aria-expanded="false"><sup>*</sup></a></td>
<td><code>\p{EMOJI}</code></td>
<td></td>
<td>😊</td>
<td></td>
</tr>
<tr class="odd">
<td>Specific scripts, e.g.&nbsp;Hangul<a href="#fninv" class="footnote-ref" role="doc-noteref" aria-expanded="false"><sup>*</sup></a></td>
<td><code>\p{HANG}</code></td>
<td></td>
<td><code>한글</code></td>
<td></td>
</tr>
</tbody>
</table>
</div>
<section id="table-notes-1" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="table-notes-1">Table notes</h4>
<p>*) <span id="fninv">These selectors can be inverted by changing them into capital letters. Thus, <code>\W</code> matches everything except word characters, and <code>\P\{PUNCTUATION\}</code> matches everything except punctuation.</span></p>
<p>†) <span id="fnuni">See <a href="https://www.unicode.org/reports/tr44/#Property_Index">www.unicode.org/reports/tr44/#Property_Index</a> for a full list of Unicode properties. Note that when using Python, these are only available if you use <em>regex</em>, which is a drop-in replacement for the more common <em>re</em>.</span></p>
<hr>
<p>In Table <a href="#tbl-regex"><span>9.2</span></a> you will find an overview of the most important parts of regular expression syntax.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> The first part shows a number of common specifiers for determining what to match, e.g.&nbsp;letters, digits, etc., followed by the quantifiers available to determine how often something should be matched. These quantifiers always follow a specifier, i.e.&nbsp;you first say what you’re looking for, and then how many of those you need. Note that by default quantifiers are <em>greedy</em>, meaning they match as many characters as possible. For example, <code>&lt;.*&gt;</code> will match everything between angle brackets, but if you have something like <code>&lt;p&gt;a paragraph&lt;/p&gt;</code> it will happily match everything from the first opening bracket to the last closing bracket. By appending a question mark (<code>?</code>) to the quantifier, it becomes <em>non-greedy</em>. so, <code>&lt;.*?&gt;</code> will match the individual <code>&lt;p&gt;</code> and <code>&lt;/p&gt;</code> substrings.</p>
<p>The third section discusses other constructs. <code>Groups</code> are formed using parentheses <code>()</code> and are useful in at least three ways. First, by default a quantifier applies to the letter directly before it, so <code>no+</code> matches “no”, “nooo”, etc. If you group a number of characters you can apply a quantifier to the group. So, <code>that's( not)? good</code> matches either “that’s not good” or “that’s good”. Second, when using a vertical bar (|) to have multiple options, you very often want to put them into a group so you can use it as part of a larger pattern. For example, <code>a( great| fantastic)? victory</code> matches either “a victory”, “a great victory”, or “a fantastic victory”. Third, as will be discussed below in Section <a href="#sec-regextract"><span>9.3</span></a>, you can use groups to capture (extract) a specific part of a string, e.g.&nbsp;to get only the domain part of a web address.</p>
<p>The other important construct are <em>character classes</em>, formed using square brackets <code>[]</code>. Within a character class, you can specify a number of different characters that you want to match, using a dash (<code>-</code>) to indicate a range. You can add as many characters as you want: <code>[A-F0-9]</code> matches digits and capital letters A through F. You can also invert this selection using an initial caret: <code>[^a-z]</code> matches everything except for lowercase Latin letters. Finally, you sometimes need to match a control character (e.g.&nbsp;<code>+</code>, <code>?</code>, <code>\</code>). Since those characters have a special meaning within a regular expressing, they cannot be used directly. The solution is to add a backslash (<code>\</code>) behind them to <em>escape</em> them: <code>.</code> matches any character, but <code>\.</code> matches an actual period. <code>\\</code> matches an actual backslash.</p>
</section>
</section>
<section id="sec-regexamples" class="level3" data-number="9.2.2">
<h3 data-number="9.2.2" class="anchored" data-anchor-id="sec-regexamples"><span class="header-section-number">9.2.2</span> Example Patterns</h3>
<p>Using the syntax explained in the previous section, we can now make patterns for common tasks in cleaning and analyzing text. Table <a href="#tbl-regexample"><span>9.3</span></a> lists a number of regular expressions for common tasks such as finding dates or stripping HTML artifacts.</p>
<div id="tbl-regexample" class="anchored">
<table class="table">
<caption>Table&nbsp;9.3: Regular expression syntax in Python and R</caption>
<thead>
<tr class="header">
<th>Goal</th>
<th>Pattern</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>US Zip Code</td>
<td><code>\d{5}</code></td>
<td><code>90210</code></td>
</tr>
<tr class="even">
<td>US Phone number</td>
<td><code>(\d{3}-)?\d{3}-\d{4}</code></td>
<td><code>202-456-1111</code>,<code>456-1111</code></td>
</tr>
<tr class="odd">
<td>Dutch Postcode</td>
<td><code>\d{4} ?[A-Za-z]{2}</code></td>
<td><code>1015 GK</code></td>
</tr>
<tr class="even">
<td>ISO Date</td>
<td><code>\d{4}-\d{2}-\d{2}</code></td>
<td><code>2020-07-20</code></td>
</tr>
<tr class="odd">
<td>German Date</td>
<td><code>\d{1,2}\.\d{1,2}\.\d{4}</code></td>
<td><code>25.6.1988</code></td>
</tr>
<tr class="even">
<td>International phone number</td>
<td><code>\+(\d[-]?){7,}\d</code></td>
<td><code>+1 555-1234567</code></td>
</tr>
<tr class="odd">
<td>URL</td>
<td><code>https?://\S+</code></td>
<td><code>https://example.com?a=b</code></td>
</tr>
<tr class="even">
<td>E-mail address</td>
<td><code>[\w\.-]+@[\w\.-]+\.\w+</code></td>
<td><code>me@example.com</code></td>
</tr>
<tr class="odd">
<td>HTML tags</td>
<td><code>&lt;/?\w[^&gt;]*&gt;</code></td>
<td><code>&lt;/html&gt;</code></td>
</tr>
<tr class="even">
<td>HTML Character escapes</td>
<td><code>&amp;[^;]+;</code></td>
<td><code>&amp;nbsp;</code></td>
</tr>
</tbody>
</table>
</div>
<p>Please note that most of these patterns do not correctly distinguish all edge cases (and hence may lead to false negatives and/or false positives) and are provided for educational purposes only.</p>
<p>We start with a number of relatively simple patterns for Zip codes and phone numbers. Starting with the simplest example, US Zip codes are simply five consecutive numbers. Next, a US phone number can be written down as three groups of numbers separated by parentheses, where the first group is made optional for local phone numbers using parentheses to group these numbers so the question mark applies to the whole group. Next, Dutch postal codes are simply four numbers followed by two letters, and we allow an optional space in between. Similarly simple, dates in ISO format are three groups of numbers separated by dashes. German dates follow a different order, use periods as separator, and allow for single-digit day and month numbers. Note that these patterns do not check for the validity of dates. A simple addition would be to restrict months to 01-12, e.g.&nbsp;using <code>(0[1-9]|1[0-2])</code>. However, in general validation is better left to specialized libraries, as properly validating the day number would require taking the month (and leap years) into account.</p>
<p>A slightly more complicated pattern is the one given for international phone numbers. They always start with a plus sign and contain at least eight numbers, but can contain dashes and spaces depending on the country. So, after the literal <code>+</code> (which we need to escape since <code>+</code> is a control character), we look for seven or more numbers, optionally followed by a single dash or space, and end with a single number. This allows dashes and spaces at any position except the start and end, but does not allow for e.g.&nbsp;double dashes. It also makes sure that there are at least eight numbers regardless of how many dashes or spaces there are.</p>
<p>The final four examples are patterns for common notations found online. For URLs, we look for <code>http://</code> or <code>https://</code> and take everything until the next space or end of the string. For email addresses, we define a character class for letters, periods, or dashes and look for it before and after the at sign. Then, there needs to be at least one period and a top level domain containing only letters. Note that the dash within the character class does not need to be escaped because it is the final character in the class, so it cannot form a range. For HTML tags and character escapes, we anchor the start (<code>&lt;</code> and <code>&amp;</code>) and end (<code>&gt;</code> and <code>;</code>) and allow any characters except for the ending character in between using an inverted character class.</p>
<p>Note that these example patterns would also match if the text is enclosed in a larger text. For example, the zip code pattern would happily match the first five numbers of a 10-digit number. If you want to check that an input value is a valid zip code (or email address, etc.), you probably want to check that it only contains that code by surrounding it with start-of-text and end-of-text markers: <code>^\d{5}$</code>. If you want to extract e.g.&nbsp;zip codes from a longer document, it is often useful to surround them with word boundary markers: <code>\b\d{5}\b</code>.</p>
<p>Please note that many of those patterns are not necessarily fully complete and correct, especially the final patterns for online notations. For example, email addresses can contain plus signs in the first part, but not in the domain name, while domain names are not allowed to start with a dash – a completely correct regular expression to match email addresses is over 400 characters long! Even worse, complete HTML tags are probably not even possible to describe using regular expressions, because HTML tags frequently contain comments and nested escapes within attributes. For a better way to deal with analyzing HTML, please see Chapter <a href="chapter12.html"><span>12</span></a>. In the end, patterns like these are fine for a (somewhat) noisy analysis of (often also somewhat noisy) source texts as long as you understand the limitations.</p>
</section>
</section>
<section id="sec-regextract" class="level2" data-number="9.3">
<h2 data-number="9.3" class="anchored" data-anchor-id="sec-regextract"><span class="header-section-number">9.3</span> Using Regular Expressions in Python and R</h2>
<p>Now that you hopefully have a firm grasp of the syntax of regular expressions, it is relatively easy to use these patterns in Python or R (or most other languages). Table <a href="#tbl-regextract"><span>9.4</span></a> lists the commands for four of the most common use cases: identifying matching texts, removing and replacing all matching text, extracting matched groups, and splitting texts.</p>
<div id="tbl-regextract" class="anchored">
<table class="table">
<caption>Table&nbsp;9.4: Regular expression syntax</caption>
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th>Operation</th>
<th>R (<em>stringr</em>)</th>
<th>Python</th>
<th>Pandas</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td></td>
<td>(whole column)</td>
<td>(single string)</td>
<td>(whole column)</td>
</tr>
<tr class="even">
<td>Does pattern p occur in text t?</td>
<td><code>str_detect(t, p)</code></td>
<td><code>re.search(p, t)</code></td>
<td><code>t.str.contains(p)</code></td>
</tr>
<tr class="odd">
<td>Does text t start with pattern p?</td>
<td><code>str_detect(t, "\^p")</code></td>
<td><code>re.match(p, t)</code></td>
<td><code>t.str.match(p)</code></td>
</tr>
<tr class="even">
<td>Count occurrences of p in t</td>
<td><code>str_count(t, "\^p")</code></td>
<td><code>re.match(p, t)</code></td>
<td><code>t.str.count(p)</code></td>
</tr>
<tr class="odd">
<td>Remove all occurences of p in t</td>
<td><code>str_remove_all(t, p)</code></td>
<td><code>re.sub(p, "", t)</code></td>
<td><code>t.str.replace(p, "")</code></td>
</tr>
<tr class="even">
<td>Replace p by r in text t</td>
<td><code>str_replace_all(t, p, r)</code></td>
<td><code>re.sub(p, r, t)</code></td>
<td><code>t.str.replace(p, r)</code></td>
</tr>
<tr class="odd">
<td>Extract the first match of p in t</td>
<td><code>str_extract(t, p)</code></td>
<td><code>re.search(p, t).group(1)</code></td>
<td><code>t.str.extract(p)</code></td>
</tr>
<tr class="even">
<td>Extract all matches of p in t</td>
<td><code>str_extract_all(t, p)</code></td>
<td><code>re.findall(p, t)</code></td>
<td><code>t.str.extractall(p)</code></td>
</tr>
<tr class="odd">
<td>Split t on matches of p</td>
<td><code>str_split(t, p)</code></td>
<td><code>re.split(p, t)</code></td>
<td><code>t.str.split(p)</code></td>
</tr>
</tbody>
</table>
</div>
<p>Note: if using Unicode character properties (<code>\p</code>), use the same functions in package <em>regex</em> instead of <em>re</em></p>
<p>For R, we again use the functions from the <em>stringr</em> package. For Python, you can use either the <em>re</em> or <em>regex</em> package, which both support the same functions and syntax so you can just import one or the other. The <em>re</em> package is more common and significantly faster, but does not support Unicode character properties (<code>\p</code>). We also list the corresponding commands for <em>pandas</em>, which are run on a whole column instead of a single text (but note that <em>pandas</em> does not support Unicode character properties.)</p>
<p>Finally, a small but important note about <em>escaping</em> special characters by placing a backslash (<code>\</code>) before them. The regular expression patterns are used <em>within</em> another language (in this case, Python or R), but these languages have their own special characters which are also escaped. In Python, you can create a <em>raw string</em> by putting a single <code>r</code> before the opening quotation mark: <code>r"\d+"</code> creates the regular expression pattern <code>\d</code>. From version 4.0 (released in spring 2020), R has a similar construct: <code>r"(\d+)"</code>. In R, the parentheses are part of the string delimiters, but you can use more parentheses within the string without a problem. The only thing you cannot include in a string is the closing sequence <code>)"</code>, but as you are also allowed to use square or curly brackets instead of parentheses and single instead of double quotes to delimit the raw string you can generally avoid this problem: to create the pattern <code>"(cat|dog)"</code> (i.e.&nbsp;cat or dog enclosed in quotation marks), you can use <code>r"{"(cat|dog)"}"</code> or <code>r'("(cat|dog)")'</code> (or even more legible: <code>r'{"(cat|dog)"}'</code>).</p>
<p>Unfortunately, in earlier versions of R (and in any case if you don’t use raw strings), you need to escape special characters twice: first for the regular expression, and then for R. So, the pattern <code>\d</code> becomes <code>"\\d"</code>. To match a literal backslash you would use the pattern <code>\\</code>, which would then be represented in R as <code>"\\\\"</code>!</p>
<p>Example <a href="#exm-reclean"><span>9.3</span></a> cleans the same text as Example <a href="#exm-clean"><span>9.2</span></a> above, this time using regular expressions. First, it uses <code>&lt;[^&gt;+]&gt;</code> to match all HTML tags: an angular opening bracket, followed by anything except for a closing angular bracket (<code>[^&gt;]</code>), repeated one or more times (<code>+</code>), finally followed by a closing bracket. Next, it replaces one or more whitespace characters (<code>\s+</code>) by a single space. Finally, it uses a vertical bar to select either space at the start of the string (<code>^\s+</code>), or at the end (<code>\s+$</code>), and removes it. As you can see, you can express a lot of patterns using regular expressions in this way, making for more generic (but sometimes less readable) clean-up code.</p>
<div class="callout-note callout callout-style-simple no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<div id="exm-reclean" class="theorem example">
<p><span class="theorem-title"><strong>Example 9.3 </strong></span>Using regular expressions to clean a text</p>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-6-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-1" role="tab" aria-controls="tabset-6-1" aria-selected="true">Python code</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-2" role="tab" aria-controls="tabset-6-2" aria-selected="false">R code</a></li></ul>
<div class="tab-content">
<div id="tabset-6-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-6-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>text <span class="op">=</span> <span class="st">"""   &lt;b&gt;Communication&lt;/b&gt;    </span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="st">    (from Latin communicare, meaning to share) """</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="co"># remove tags:</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>cleaned <span class="op">=</span> re.sub(<span class="st">"&lt;[^&gt;]+&gt;"</span>, <span class="st">""</span>, text)</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="co"># normalize white space</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>cleaned <span class="op">=</span> re.sub(<span class="st">"\s+"</span>, <span class="st">" "</span>, cleaned)</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a><span class="co"># trim spaces from start and end</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>cleaned <span class="op">=</span> re.sub(<span class="st">"^\s+|\s+$"</span>, <span class="st">""</span>, cleaned)</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>cleaned <span class="op">=</span> cleaned.strip()</span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(cleaned)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Communication (from Latin communicare, meaning to share)</code></pre>
</div>
</div>
</div>
<div id="tabset-6-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>text <span class="ot">=</span> <span class="st">"    &lt;b&gt;Communication&lt;/b&gt;    </span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="st">     (from Latin communicare, meaning to share)  "</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>cleaned <span class="ot">=</span> text <span class="sc">%&gt;%</span> </span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># remove HTML tags:</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_replace_all</span>(<span class="st">"&lt;[^&gt;]+&gt;"</span>, <span class="st">" "</span>)  <span class="sc">%&gt;%</span> </span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># normalize white space </span></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_replace_all</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">p{space}+"</span>, <span class="st">" "</span>)  <span class="sc">%&gt;%</span> </span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># trim spaces at start and end</span></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_remove_all</span>(<span class="st">"^</span><span class="sc">\\</span><span class="st">s+|</span><span class="sc">\\</span><span class="st">s+$"</span>)</span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>cleaned</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Communication (from Latin communicare, meaning to share)"</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<p>Finally, Example <a href="#exm-cleanpandas"><span>9.4</span></a> shows how you can run the various commands on a whole column of text rather than on individual strings, using a small set of made-up tweets to showcase various operations. First, we determine whether a pattern occurs, in this case for detecting hashtags. This is very useful for e.g.&nbsp;subsetting a data frame to only rows that contain this pattern. Next, we count how many at-mentions are contained in the text, where we require that the character before the mention needs to be either whitespace or the start of the string (<code>^</code>), to exclude email addresses and other non-mentions that do contain at signs. Then, we extract the (first) url found in the text, if any, using the pattern discussed above. Finally, we extract the plain text of the tweet in two chained operations: first, we remove every word starting with an at-sign, hash, or http, removing everything up to the next whitespace character. Then, we replace everything that is not a letter by a single space.</p>
<div class="callout-note callout callout-style-simple no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<div id="exm-cleanpandas" class="theorem example">
<p><span class="theorem-title"><strong>Example 9.4 </strong></span>Using regular expressions on a data frame</p>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-7-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-1" role="tab" aria-controls="tabset-7-1" aria-selected="true">Python code</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-7-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-2" role="tab" aria-controls="tabset-7-2" aria-selected="false">R code</a></li></ul>
<div class="tab-content">
<div id="tabset-7-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-7-1-tab">
<div class="cell">

</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>url <span class="op">=</span> <span class="st">"https://cssbook.net/d/example_tweets.csv"</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>tweets <span class="op">=</span> pd.read_csv(url, index_col<span class="op">=</span><span class="st">"id"</span>)</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="co"># identify tweets with hashtags</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>tweets[<span class="st">"tag"</span>] <span class="op">=</span> tweets.text.<span class="bu">str</span>.contains(<span class="vs">r"#\w+"</span>)</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a><span class="co"># How many at-mentions are there?</span></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>tweets[<span class="st">"at"</span>] <span class="op">=</span> tweets.text.<span class="bu">str</span>.count(<span class="vs">r"(^|\s)@\w+"</span>)</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract first url</span></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>tweets[<span class="st">"url"</span>] <span class="op">=</span> tweets.text.<span class="bu">str</span>.extract(<span class="vs">r"(https?://\S+)"</span>)</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove urls, tags, and @-mentions</span></span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>expr <span class="op">=</span> <span class="vs">r"(^|\s)(@|#|https?://)\S+"</span></span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>tweets[<span class="st">"plain2"</span>] <span class="op">=</span> tweets.text.<span class="bu">str</span>.replace(expr, <span class="st">" "</span>, regex<span class="op">=</span><span class="va">True</span>).replace(</span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>    <span class="vs">r"\W+"</span>, <span class="st">" "</span></span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a>tweets</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                       text  ...                   plain2
id                                           ...                         
1   RT: @john_doe https://example.com/ne...  ...  RT:   very interesting!
2                      tweet with just text  ...     tweet with just text
3   http://example.com/pandas #breaking ...  ...                         
4               @me and @myself #selfietime  ...                    and  

[4 rows x 5 columns]</code></pre>
</div>
</div>
</div>
<div id="tabset-7-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-7-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>url<span class="ot">=</span><span class="st">"https://cssbook.net/d/example_tweets.csv"</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>tweets <span class="ot">=</span> <span class="fu">read_csv</span>(url)</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>tweets <span class="ot">=</span> tweets <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># identify tweets with hashtags</span></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">has_tag=</span><span class="fu">str_detect</span>(text, <span class="st">"#</span><span class="sc">\\</span><span class="st">w+"</span>),</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># How many at-mentions are there?</span></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_at =</span> <span class="fu">str_count</span>(text, <span class="st">"(^|</span><span class="sc">\\</span><span class="st">s)@</span><span class="sc">\\</span><span class="st">w+"</span>),</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract first url</span></span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">url =</span> <span class="fu">str_extract</span>(text, <span class="st">"(https?://</span><span class="sc">\\</span><span class="st">S+)"</span>),</span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Remove at-mentions, tags, and urls</span></span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">plain2 =</span> <span class="fu">str_replace_all</span>(text, </span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a>       <span class="st">"(^|</span><span class="sc">\\</span><span class="st">s)(@|#|https?://)</span><span class="sc">\\</span><span class="st">S+"</span>, <span class="st">" "</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a>             <span class="fu">str_replace_all</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">W+"</span>, <span class="st">" "</span>)</span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a>tweets</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 6
     id text                                          has_tag  n_at url   plain2
  &lt;dbl&gt; &lt;chr&gt;                                         &lt;lgl&gt;   &lt;int&gt; &lt;chr&gt; &lt;chr&gt; 
1     1 RT: @john_doe https://example.com/news very … FALSE       1 http… "RT v…
2     2 tweet with just text                          FALSE       0 &lt;NA&gt;  "twee…
3     3 http://example.com/pandas #breaking #mustread TRUE        0 http… " "   
4     4 @me and @myself #selfietime                   TRUE        2 &lt;NA&gt;  " and…</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<section id="sec-regexadvanced" class="level3" data-number="9.3.1">
<h3 data-number="9.3.1" class="anchored" data-anchor-id="sec-regexadvanced"><span class="header-section-number">9.3.1</span> Splitting and Joining Strings, and Extracting Multiple Matches</h3>
<p>So far, the operations we used all took a single string object and returned a single value, either a cleaned version of the string or e.g.&nbsp;a boolean indicating whether there is a match. This is convenient when using data frames, as you can transform a single column into another column. There are three common operations, however, that complicate matters: you can <em>split</em> a string into multiple substrings, or <em>extract</em> multiple matches from a string, and you can <em>join</em> multiple matches together.</p>
<div class="callout-note callout callout-style-simple no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<div id="exm-split" class="theorem example">
<p><span class="theorem-title"><strong>Example 9.5 </strong></span>Splitting extracting and joining a single text</p>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-8-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-1" role="tab" aria-controls="tabset-8-1" aria-selected="true">Python code</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-8-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-2" role="tab" aria-controls="tabset-8-2" aria-selected="false">R code</a></li></ul>
<div class="tab-content">
<div id="tabset-8-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-8-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>text <span class="op">=</span> <span class="st">"apples, pears, oranges"</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Three ways to achieve the same thing:</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>items <span class="op">=</span> text.split(<span class="st">", "</span>)</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>items <span class="op">=</span> regex.split(<span class="vs">r"\p</span><span class="sc">{PUNCTUATION}</span><span class="vs">\s*"</span>, text)</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>items <span class="op">=</span> regex.findall(<span class="vs">r"\p</span><span class="sc">{LETTER}</span><span class="vs">+"</span>, text)</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Split text into items: </span><span class="sc">{</span>items<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Split text into items: ['apples', 'pears', 'oranges']</code></pre>
</div>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>joined <span class="op">=</span> <span class="st">" &amp; "</span>.join(items)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(joined)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>apples &amp; pears &amp; oranges</code></pre>
</div>
</div>
</div>
<div id="tabset-8-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-8-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>text <span class="ot">=</span> <span class="st">"apples, pears, oranges"</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>items<span class="ot">=</span><span class="fu">strsplit</span>(text,<span class="st">", "</span>, <span class="at">fixed=</span>T)[[<span class="dv">1</span>]]</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>items<span class="ot">=</span><span class="fu">str_split</span>(text,<span class="st">"</span><span class="sc">\\</span><span class="st">p{PUNCTUATION}</span><span class="sc">\\</span><span class="st">s*"</span>)[[<span class="dv">1</span>]]</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>items<span class="ot">=</span><span class="fu">str_extract_all</span>(text,<span class="st">"</span><span class="sc">\\</span><span class="st">p{LETTER}+"</span>)[[<span class="dv">1</span>]]</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(items)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "apples"  "pears"   "oranges"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>joined <span class="ot">=</span> <span class="fu">str_c</span>(items, <span class="at">collapse=</span><span class="st">" &amp; "</span>)</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(joined)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "apples &amp; pears &amp; oranges"</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<p>Example <a href="#exm-split"><span>9.5</span></a> shows the “easier” case of splitting up a single text and joining the result back together. We show three different ways to split: using a fixed pattern to split on (in this case, a comma plus space); using a regular expression (in this case, any punctuation followed by any space); and by matching the items we are interested in (letters) rather than the separator. Finally, we join these items together again using <code>join</code> (Python) and <code>str_c</code> (R).</p>
<p>One thing to note in the previous example is the use of the index <code>[[1]]</code> in R to select the first element in a list. This is needed because in R, splitting a text actually splits all the given texts, returning a <code>list</code> containing all the matches for each input text. If there is only a single input text, it still returns a list, so we select the first element of the list.</p>
<p>In many cases, however, you are not working on a single text but rather on a series of texts loaded into a data frame, from tweets to news articles and open survey questions. In the example above, we extracted only the first url from each tweet. If we want to extract e.g.&nbsp;all hash tags from each tweet, we cannot simply add a “tags” column, as there can be multiple tags in each tweet. Essentially, the problem is that the URLs per tweet are now nested in each row, creating a non-rectangular data structure.</p>
<p>Although there are multiple ways of dealing with this, if you are working with data frames our advice is to normalize the data structure to a long format. In the example, that would mean that each tweet is now represented by multiple rows, namely one for each hash tag. Example <a href="#exm-splitlong"><span>9.6</span></a> shows how this can be achieved in both R and Pandas. One thing to note is that in pandas, <code>t.str.extractall</code> automatically returns the desired long format, but it is essential that the index of the data frame actually contains the identifier (in this case, the tweet (status) id). <code>t.str.split</code>, however, returns a data frame with a column containing lists, similar to how both R functions return a list containing character vectors. We can normalize this to a long data frame using <code>t.explode</code> (pandas) and <code>pivot_longer</code> (R). After this, we can use all regular data frame operations, for example to join and summarize the data.</p>
<p>A final thing to note is that while you normally use a function like <code>mean</code> to summarize the values in a group, you can also join strings together as a summarization. The only requirement for a summarization function is that it returns a single value for a group of values, which of course is exactly what joining a multiple string together does. This is shown in the final line of the example, where we split a tweet into words and then reconstruct the tweet from the individual words.</p>
<div class="callout-note callout callout-style-simple no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<div id="exm-splitlong" class="theorem example">
<p><span class="theorem-title"><strong>Example 9.6 </strong></span>Applying split and extract _ all on text columns</p>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-9-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-1" role="tab" aria-controls="tabset-9-1" aria-selected="true">Python code</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-9-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-2" role="tab" aria-controls="tabset-9-2" aria-selected="false">R code</a></li></ul>
<div class="tab-content">
<div id="tabset-9-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-9-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>tags <span class="op">=</span> tweets.text.<span class="bu">str</span>.extractall(<span class="st">"(#</span><span class="ch">\\</span><span class="st">w+)"</span>)</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>tags.merge(tweets, left_on<span class="op">=</span><span class="st">"id"</span>, right_on<span class="op">=</span><span class="st">"id"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              0  ...   plain2
id               ...         
3     #breaking  ...         
3     #mustread  ...         
4   #selfietime  ...    and  

[3 rows x 6 columns]</code></pre>
</div>
</div>
</div>
<div id="tabset-9-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-9-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>tags <span class="ot">=</span> tweets <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">tag=</span><span class="fu">str_extract_all</span>(tweets<span class="sc">$</span>text,<span class="st">"(#</span><span class="sc">\\</span><span class="st">w+)"</span>))<span class="sc">%&gt;%</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id, tag)</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>tags_long <span class="ot">=</span> tags  <span class="sc">%&gt;%</span> <span class="fu">unnest</span>(tag)</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a><span class="fu">left_join</span>(tags_long, tweets)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 7
     id tag         text                              has_tag  n_at url   plain2
  &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;                             &lt;lgl&gt;   &lt;int&gt; &lt;chr&gt; &lt;chr&gt; 
1     3 #breaking   http://example.com/pandas #break… TRUE        0 http… " "   
2     3 #mustread   http://example.com/pandas #break… TRUE        0 http… " "   
3     4 #selfietime @me and @myself #selfietime       TRUE        2 &lt;NA&gt;  " and…</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-10-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-1" role="tab" aria-controls="tabset-10-1" aria-selected="true">Python code</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-10-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-2" role="tab" aria-controls="tabset-10-2" aria-selected="false">R code</a></li></ul>
<div class="tab-content">
<div id="tabset-10-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-10-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>words <span class="op">=</span> tweets.text.<span class="bu">str</span>.split(<span class="st">"</span><span class="ch">\\</span><span class="st">W+"</span>)</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>words_long <span class="op">=</span> words.explode()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-10-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-10-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>words <span class="ot">=</span> tweets <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">word=</span><span class="fu">str_split</span>(tweets<span class="sc">$</span>text, <span class="st">"</span><span class="sc">\\</span><span class="st">W+"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id, word)</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>words_long <span class="ot">=</span> words <span class="sc">%&gt;%</span> <span class="fu">unnest</span>(word)</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(words_long)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 2
     id word    
  &lt;dbl&gt; &lt;chr&gt;   
1     1 RT      
2     1 john_doe
3     1 https   
4     1 example 
5     1 com     
6     1 news    </code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-11-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-11-1" role="tab" aria-controls="tabset-11-1" aria-selected="true">Python code</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-11-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-11-2" role="tab" aria-controls="tabset-11-2" aria-selected="false">R code</a></li></ul>
<div class="tab-content">
<div id="tabset-11-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-11-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>words_long.groupby(<span class="st">"id"</span>).agg(<span class="st">"_"</span>.join)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>id
1    RT_john_doe_https_example_com_news_v...
2                       tweet_with_just_text
3    http_example_com_pandas_breaking_mus...
4                  _me_and_myself_selfietime
Name: text, dtype: object</code></pre>
</div>
</div>
</div>
<div id="tabset-11-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-11-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>words_long <span class="sc">%&gt;%</span> </span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> </span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">joined=</span><span class="fu">str_c</span>(word, <span class="at">collapse=</span><span class="st">"_"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 2
     id joined                                              
  &lt;dbl&gt; &lt;chr&gt;                                               
1     1 RT_john_doe_https_example_com_news_very_interesting_
2     2 tweet_with_just_text                                
3     3 http_example_com_pandas_breaking_mustread           
4     4 _me_and_myself_selfietime                           </code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>


</section>
</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>Note that this is not a full review of everything that is possible with regular expressions, but this includes the most used options and should be enough for the majority of cases. Moreover, if you descend into the more specialized aspects of regular expressions (with beautiful names such as “negative lookbehind assertions”) you will also run into differences between Python, R, and other languages, while the features used in this chapter should function in most implementations you come across unless specifically noted.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./chapter08.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Statistical Modeling and Supervised Machine Learning</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./chapter10.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Text as data</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>